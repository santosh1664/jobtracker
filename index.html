<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Job Application Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#f6f7f9;
      --bg-dark:#1f2937;
      --text:#1f2937;
      --text-dark:#f9fafb;
      --bg-image:none; /* update later with url("yourimage.jpg") */
    }
    body {
      margin:0;
      background:var(--bg) var(--bg-image) no-repeat center center fixed;
      background-size:cover;
      color:var(--text);
      font-family: system-ui, sans-serif;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background:var(--bg-dark) var(--bg-image) no-repeat center center fixed;
      background-size:cover;
      color:var(--text-dark);
    }
    .wrap { max-width:1100px; margin:0 auto; padding:24px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .between { justify-content:space-between; align-items:center; }
    .title { font-size:22px; font-weight:700; }
    .card { background:#fff; border:1px solid #ddd; border-radius:16px; box-shadow:0 1px 8px rgba(0,0,0,.05); }
    body.dark .card { background:#374151; border-color:#4b5563; }
    .pad { padding:16px; }
    .kpi { flex:1 1 180px; }
    .kpi .label { font-size:12px; color:#6b7280; }
    .kpi .value { font-size:28px; font-weight:700; margin-top:4px; }
    .kpi.applied { border-left:6px solid #facc15; }
    .kpi.interview { border-left:6px solid #3b82f6; }
    .kpi.offer { border-left:6px solid #22c55e; }
    .kpi.rejected { border-left:6px solid #ef4444; }
    button.switch { position:fixed; top:16px; right:16px; background:#fff; border:1px solid #ddd; border-radius:8px; padding:8px 12px; cursor:pointer; }
    body.dark button.switch { background:#374151; color:#f9fafb; border-color:#555; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:12px; border-top:1px solid #ddd; text-align:left; }
    thead th { background:#f3f4f6; }
    body.dark thead th { background:#4b5563; color:#f9fafb; }
  </style>
</head>
<body>
  <button class="switch" id="modeBtn">üåô Dark</button>
  <div class="wrap">
    <div class="row between">
      <div class="title">Job Application Tracker</div>
      <button id="signOutBtn">Sign out</button>
    </div>

    <!-- KPI Cards -->
    <div class="row" style="margin-top:16px">
      <div class="card kpi"><div class="pad"><div class="label">Total Jobs</div><div id="kpi-total" class="value">0</div></div></div>
      <div class="card kpi applied"><div class="pad"><div class="label">Applied</div><div id="kpi-applied" class="value">0</div></div></div>
      <div class="card kpi interview"><div class="pad"><div class="label">Interview</div><div id="kpi-interview" class="value">0</div></div></div>
      <div class="card kpi offer"><div class="pad"><div class="label">Offer</div><div id="kpi-offer" class="value">0</div></div></div>
      <div class="card kpi rejected"><div class="pad"><div class="label">Rejected</div><div id="kpi-rejected" class="value">0</div></div></div>
    </div>

    <!-- Table -->
    <div class="card" style="margin-top:16px">
      <div class="pad">
        <table>
          <thead><tr><th>Status</th><th>Company</th><th>Role</th><th>Date</th><th>Link</th><th>Notes</th><th>Actions</th></tr></thead>
          <tbody id="tbody"><tr><td colspan="7">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBPzBs2FitAa1lvvpfc9HrU_gCu3SKMcow",
      authDomain: "jobt-d9f5b.firebaseapp.com",
      databaseURL: "https://jobt-d9f5b-default-rtdb.firebaseio.com",
      projectId: "jobt-d9f5b",
      storageBucket: "jobt-d9f5b.appspot.com",
      messagingSenderId: "661162100470",
      appId: "1:661162100470:web:d7d3880b0acd6ae58d8ed7",
      measurementId: "G-B8N2Q5D0NN"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const signOutBtn=document.getElementById("signOutBtn");
    const modeBtn=document.getElementById("modeBtn");
    const tbody=document.getElementById("tbody");

    // Redirect if not signed in
    onAuthStateChanged(auth,(user)=>{
      if(!user) { window.location.href="login.html"; return; }
      const jobsRef=ref(db,`users/${user.uid}/jobs`);
      onValue(jobsRef,snap=>{
        const jobs=Object.values(snap.val()||{});
        tbody.innerHTML="";
        jobs.forEach(j=>{
          const tr=document.createElement("tr");
          tr.innerHTML=`<td>${j.status}</td><td>${j.company}</td><td>${j.role}</td><td>${new Date(j.date).toLocaleDateString()}</td><td>${j.link||""}</td><td>${j.notes||""}</td><td><button>Delete</button></td>`;
          tbody.appendChild(tr);
        });
      });
    });

    // Sign out
    signOutBtn.addEventListener("click", async ()=>{ await signOut(auth); window.location.href="login.html"; });

    // Dark/Light mode toggle
    modeBtn.addEventListener("click",()=>{
      document.body.classList.toggle("dark");
      modeBtn.textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è Light":"üåô Dark";
    });
  </script>
</body>
</html>
